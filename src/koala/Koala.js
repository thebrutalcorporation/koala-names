import React, { useRef, useEffect } from "react";
import { gsap, Power2 } from "gsap";
import { MorphSVGPlugin } from "gsap/MorphSVGPlugin";
import { DrawSVGPlugin } from "gsap/DrawSVGPlugin";

import "./koala.css";

gsap.registerPlugin(MorphSVGPlugin);
gsap.registerPlugin(DrawSVGPlugin);

function Koala() {
  const koala = useRef();
  // const q = gsap.utils.selector(koala);

  useEffect(() => {
    gsap.to(koala.current, {
      visibility: "visible",
    });

    const master = gsap.timeline();
    master.add(koalaAppears(), "koalaAppears");
    master.add(blink(), "blink");
    master.add(waves(), "waves");
  }, []);

  return (
    <>
      <h1 className="hello">Gday, Mate!</h1>

      <svg
        ref={koala}
        className="koala"
        // width="684px"
        // height="631px"
        viewBox="0 0 684 631"
      >
        <title>Standing Koala</title>

        <polygon
          id="leg-1"
          points="312.370576 520.730608 316.425907 520.730608 320.135484 520.730608 323.273771 520.427585 326.357258 519.648888 328.134432 523.182273 332.704361 531.029108 336.412313 537.076411 339.871241 542.138489 346.261457 550.582022 351.199739 556.140896 356.126751 561.449943 362.893005 567.423377 369.273325 572.361109 373.875217 575.462231 371.59474 576.561341 368.912637 578.184349 365.78034 580.369949 363.631403 582.320827 361.221615 584.824378 359.553005 586.876115 358.550797 588.180193 357.30382 590.379744 356.126751 592.845159 355.331428 594.525098 354.666106 596.566225 354.169647 598.87498 353.900424 600.141473 353.900424 601.21427 353.900424 602.525535 353.900424 603.56429 354.119249 605.593305 354.169647 606.321491 349.962164 605.93478 346.702634 605.93478 343.122897 605.93478 339.383538 605.593305 334.824589 605.145635 330.248805 604.792207 326.357258 604.413781 321.215456 604.015746 316.425907 603.019529 312.370576 602.525535 308.259367 601.607994 304.353695 600.534186 301.521677 599.343372 298.542143 596.566225 297.104331 594.525098 295.320722 589.503052 295.320722 588.180193 295.320722 586.876115 295.320722 585.860787 295.320722 584.824378 295.773961 583.670199 296.076601 582.320827 296.485882 581.082556 297.104331 579.747478 297.718091 578.184349 298.542143 577.202166 299.618851 575.462231 301.521677 573.406124 303.205437 571.662167 304.71832 570.460047 305.901146 569.546715 308.259367 568.205964 310.262682 567.423377 313.029054 566.226935 315.950992 565.352759 318.208183 564.829287 319.4935 564.829287 321.215456 564.829287 323.745665 565.352759 324.877292 565.352759 326.357258 565.907424 324.877292 563.382968 323.745665 561.041577 320.791265 555.197246 319.088277 551.054874 317.552417 547.373905 316.425907 543.938154 315.167886 539.518948 313.992774 534.177048 313.029054 529.377138 312.370576 524.569271"
        ></polygon>
        <path
          d="M273.087655,398.761659 L276.846861,399.461676 L283.179505,400.610752 L289.432501,401.637632 L296.851516,402.663892 L303.058787,403.345361 L304.646294,403.658457 L304.186209,407.529089 L303.763823,413.884283 L303.546787,419.371781 L303.546787,425.362899 L303.763823,432.391554 L304.186209,438.839446 L304.646294,443.75786 L305.268222,450.132236 L305.744387,455.629922 L306.496061,462.113915 L306.423196,462.101811 C306.471509,462.809643 306.496061,463.524 306.496061,464.244092 C306.496061,481.364919 292.616889,495.244092 275.496061,495.244092 C258.375234,495.244092 244.496061,481.364919 244.496061,464.244092 C244.496061,460.035509 245.334721,456.022806 246.854035,452.363988 L246.851307,452.363496 L249.190367,445.276429 L251.56324,439.24615 L253.585281,435.385368 L258.656124,426.013534 L263.67578,417.029681 L267.910464,409.290726 L270.001192,405.180437 L273.087655,398.761659 Z"
          id="arm-1"
        ></path>
        <path
          d="M274.491492,397.394684 L279.39561,398.593438 L285.242952,399.961778 L291.032438,400.898433 L296.320722,402.529089 L304.546787,402.529089 L304.546787,407.893037 L301.150866,414.223326 L297.962404,422.959568 L294.503441,431.742043 L291.032438,444.504887 L287.496061,455.695832 L287.053047,455.40947 C284.604865,469.516584 272.303235,480.244092 257.496061,480.244092 C240.927519,480.244092 227.496061,466.812635 227.496061,450.244092 C227.496061,439.422107 233.226243,429.938478 241.81802,424.661789 L247.851307,420.244092 L254.798881,415.343331 L261.544433,411.846789 L266.655337,406.291286 L269.94839,400.898433 L272.643259,397.394684 L274.491492,397.394684 Z"
          id="arm-2"
        ></path>
        <path
          d="M271.496061,391.637175 L273.491492,392.394684 L280.855515,393.862624 L290.032438,395.898433 L297.788148,397.529089 L303.546787,397.529089 L295.320722,405.685374 L286.496061,415.244092 L276.673684,427.744092 L270.156499,436.404188 C266.491023,447.910049 255.716802,456.244092 242.996061,456.244092 C227.255946,456.244092 214.496061,443.484207 214.496061,427.744092 C214.496061,416.044325 221.546,405.99116 231.629529,401.600944 L231.494019,401.474403 L235.633389,399.290726 L241.387577,397.529089 L246.851307,395.898433 L251.502365,395.014379 L256.496061,393.862624 L263.082725,392.394684 L271.496061,391.637175 Z"
          id="arm-3"
        ></path>
        <path
          d="M129.57096,0.432863023 C96.4062954,11.000518 83.8050392,21.2147228 91.7671911,31.0754776 C-13.0477343,53.1373588 -17.1497766,180.69885 26.2394082,184.90312 C25.9559437,200.389017 56.5675396,262.717584 134.574314,262.181118 C132.037716,283.535825 136.200886,308.04182 148.684271,329.207632 C151.128407,333.35171 153.975973,337.422432 157.102012,341.242615 C165.183077,351.118101 175.257169,359.838678 186.015245,367.683948 C205.16455,381.648477 229.335876,392.280103 254.67165,398.761659 C264.426067,401.257095 274.356804,403.488701 284.242952,404.961778 C290.928945,405.958019 297.620837,406.851644 304.186209,407.529089 C304.076564,411.93856 303.376646,416.499109 303.546787,421.404453 C303.618168,423.462447 303.427189,426.093781 303.546787,428.337096 C303.637804,430.04432 303.832291,432.553137 303.546787,432.766494 C302.748249,433.363239 300.841159,434.831043 299.940968,435.554142 C297.386664,437.605944 294.688186,440.27265 292.289591,442.704993 C287.568777,447.492227 278.434983,461.025233 275.496061,466.690841 C268.475805,480.224383 272.598801,495.183348 273.309223,495.244092 C277.234111,510.519204 291.522032,519.143603 312.54127,520.323043 C314.081314,538.497846 319.582606,555.454848 326.828414,566.381689 C307.53778,560.750835 286.707897,582.78242 299.940968,597.479189 C304.276313,602.294004 326.155847,604.802326 354.135463,605.593305 C354.822883,609.561847 356.827734,613.394855 360.554688,616.750698 C379.589296,633.889532 538.072372,630.487542 560.446457,609.987573 C580.967516,591.185255 627.593205,436.884339 494.864624,367.683948 C531.911251,341.388414 551.493701,304.445497 546.473431,262.181118 C624.480046,262.717773 655.089155,200.389017 654.805539,184.90312 C698.194894,180.69885 694.092821,53.1373588 589.27779,31.0754776 C601.220984,16.2843454 581.914968,-0.0376012351 551.474161,0.432863023 C523.179295,0.870195942 485.266853,15.8298232 453.887703,60.0015743 C428.711514,42.4654733 393.183463,31.8687437 340.522549,31.8687437 C287.861635,31.8687437 252.333433,42.4654733 227.157267,60.0015743 C206.237926,30.5537755 173.709158,10.6975384 129.57096,0.432863023 Z"
          id="body--right-shading"
        ></path>
        <path
          d="M129.571765,0.432556881 C99.1307616,-0.0380547784 79.8238688,16.2835933 91.7671231,31.0747292 C-13.0477759,53.136618 -17.1492096,180.69987 26.2400243,184.904179 C25.9564841,200.390037 56.5664133,262.717169 134.573119,262.180703 C124.586352,346.256408 211.929455,409.290726 340.522625,409.290726 C469.115911,409.290726 556.458942,346.256408 546.472259,262.180703 C624.478836,262.717358 655.088966,200.390037 654.80535,184.904179 C698.194592,180.69987 694.093162,53.136618 589.278168,31.0747292 C601.221324,16.2835933 581.914477,-0.0378998178 551.473594,0.432556881 C523.178728,0.869901139 485.268101,15.8302881 453.889026,60.0020468 C428.712799,42.4659344 393.183577,31.8684754 340.522625,31.8684754 C287.861749,31.8684754 252.332526,42.4659344 227.156363,60.0020468 C195.777259,15.8303486 157.866631,0.869893579 129.571765,0.432556881 Z"
          id="head"
        ></path>
        <path
          d="M145.650333,91.7000831 C113.550255,91.7000831 87.5273586,117.722979 87.5273586,149.823057 C87.5273586,181.92312 113.55027,207.945993 145.650333,207.945993 C147.283807,207.933516 148.916029,207.852184 150.542651,207.702214 C161.94027,172.462919 170.42839,137.428588 186.015245,108.012184 C175.181608,97.5508522 160.710451,91.7028283 145.650333,91.7000831 L145.650333,91.7000831 Z M535.394766,91.7000831 C520.334583,91.7028225 505.863368,97.5508906 495.029713,108.012297 C510.616712,137.428701 519.104964,172.463032 530.50247,207.702327 C532.129085,207.852297 533.761299,207.933629 535.394766,207.946107 C567.49477,207.946107 593.517589,181.923174 593.517589,149.82317 C593.517589,117.723152 567.494784,91.7000831 535.394766,91.7000831 L535.394766,91.7000831 Z M304.186209,407.529089 C303.50544,416.054153 303.369755,424.625517 303.77201,433.157574 C312.01618,425.552409 320.706108,417.887489 328.596363,409.107533 C320.263941,408.849769 312.126089,408.314852 304.186209,407.529089 L304.186209,407.529089 Z M407.52318,421.404453 C391.864219,464.765348 358.122449,514.510281 327.767853,519.456699 C327.29031,519.534558 326.830077,519.580668 326.357258,519.648699 C338.593932,543.776486 355.028452,563.59013 373.875217,575.462231 C378.351274,573.511995 383.11911,572.665721 387.661422,573.401935 C366.197901,541.03406 365.083242,467.419143 430.98558,458.34994 C425.350531,446.654683 417.011419,434.288068 407.52318,421.404453 L407.52318,421.404453 Z"
          id="white-pattern"
        ></path>
        <path
          d="M394.887048,318.531154 C394.887048,355.459444 369.829082,367.60609 340.523532,367.60609 C311.21802,367.60609 286.160054,355.459444 286.160054,318.531154 C286.160054,281.602826 305.083657,232.650044 340.523532,232.650044 C375.96352,232.650044 394.887048,281.602826 394.887048,318.531154 Z"
          id="nose"
        ></path>
        <g id="eyes" transform="translate(221.645255, 211.587219)">
          <path
            d="M201.730511,0.00144493389 C199.972691,0.0203425719 198.242839,0.238799268 196.556905,0.655152029 C180.210675,4.6894198 171.419645,26.0339996 176.922637,48.3282991 C182.425214,70.6227876 200.137705,85.4248917 216.483595,81.3898302 C232.829258,77.3550333 241.618588,56.0115118 236.115898,33.7175902 C231.266877,14.0706609 216.750241,-0.162851131 201.730511,0.00140713861 L201.730511,0.00144493389 Z M36.0250984,0.487529979 C21.0053653,0.323498481 6.48991943,14.5577664 1.64063433,34.2046958 C-3.8620744,56.4986929 4.92734555,77.8421388 21.2729785,81.8769357 C37.6188874,85.9119972 55.3311144,71.1098931 60.834031,48.8154046 C66.3366074,26.5210673 57.5468624,5.1774324 41.2007079,1.14324022 C39.5146606,0.726849667 37.7829567,0.506994547 36.0250984,0.487529979 Z"
            id="iris"
          ></path>
          <path
            d="M203.132489,13.6002609 C195.043658,13.6002609 188.485988,20.1578168 188.485988,28.246724 C188.485988,36.335669 195.043658,42.8931494 203.132489,42.8931494 C211.221472,42.8931494 217.77899,36.335669 217.77899,28.246724 C217.77899,20.1578168 211.221472,13.6002609 203.132489,13.6002609 Z M34.6240275,14.0869128 C26.5350447,14.0869128 19.977553,20.644431 19.977553,28.7334138 C19.977553,36.822321 26.5350447,43.3798392 34.6240275,43.3798392 C42.7128591,43.3798392 49.2703395,36.822321 49.2703395,28.7334138 C49.2703395,20.644431 42.7128591,14.0869128 34.6240275,14.0869128 Z"
            id="pupils"
          ></path>
        </g>
      </svg>
    </>
  );
}

export default Koala;

function blink() {
  const tl = gsap.timeline({ repeat: -1, repeatDelay: 4 });
  tl.to("#eyes", 0.1, {
    scaleY: 0,
    repeat: 3,
    yoyo: true,
    transformOrigin: "50% 50%",
    ease: gsap.Ease,
  });

  return tl;
}

function waves() {
  const arms = document.querySelector("#arm-1");
  const arms2 = document.querySelector("#arm-2");
  const arms3 = document.querySelector("#arm-3");
  const tl = gsap.timeline({ repeat: -1, repeatDelay: 4 });

  tl.add("arms");
  tl.to(arms, 0.1, { morphSVG: arms2, ease: gsap.Linear }, "arms+=1");
  tl.to(arms, 0.1, { morphSVG: arms3, ease: gsap.Linear }, "arms+=1.1");
  tl.to(arms, 0.1, { morphSVG: arms2, ease: gsap.Linear }, "arms+=1.2");
  tl.to(arms, 0.1, { morphSVG: arms, ease: gsap.Linear }, "arms+=1.3");
  tl.to(arms, 0.1, { morphSVG: arms2, ease: gsap.Linear }, "arms+=1.4");
  tl.to(arms, 0.1, { morphSVG: arms3, ease: gsap.Linear }, "arms+=1.5");
  tl.to(arms, 0.1, { morphSVG: arms2, ease: gsap.Linear }, "arms+=1.6");
  tl.to(arms, 0.1, { morphSVG: arms, ease: gsap.Linear }, "arms+=1.7");

  return tl;
}

function koalaAppears() {
  MorphSVGPlugin.convertToPath(
    "circle, rect, ellipse, line, polygon, polyline"
  );

  const koalaP = document.querySelectorAll(".koala path");
  gsap.set(koalaP, {
    stroke: "#3a506b",
  });
  var tl = gsap.timeline();

  tl.fromTo(
    koalaP,
    { drawSVG: "50% 50%" },
    { drawSVG: true, duration: 3, ease: Power2.easeOut }
  );
  tl.from(koalaP, { fill: "white", duration: 3, ease: Power2.easeOut }, "-=1");
  tl.to(koalaP, { stroke: "none", duration: 2, ease: Power2.easeOut }, "-=2");

  return tl;
}
